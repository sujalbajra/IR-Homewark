{% extends "base_admin.html" %}

{% block title %}Manage Documents{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-folder-open text-primary mr-2"></i>Document Corpus</h2>
    <button class="btn btn-success shadow-sm" type="button" data-toggle="collapse" data-target="#uploadCollapse">
        <i class="fas fa-cloud-upload-alt"></i> Upload New
    </button>
</div>

<!-- Upload Section -->
<div class="collapse mb-4" id="uploadCollapse">
    <div class="card card-body bg-light border-success">
        <h5 class="card-title">Upload Text Documents</h5>
        <form method="post" enctype="multipart/form-data" class="form-inline">
            <div class="form-group mb-2">
                <input type="file" name="file" class="form-control-file">
            </div>
            <button type="submit" class="btn btn-primary mb-2 ml-3">Upload</button>
        </form>
        <small class="text-muted">Only .txt files are supported. Try naming them with categories like
            <code>doc1_sports.txt</code>.</small>
    </div>
</div>

<!-- Search/Filter -->
<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
    </div>
    <input type="text" class="form-control" id="docSearch" placeholder="Filter documents by name..."
        onkeyup="filterDocs()">
</div>

<!-- Documents List -->
<div class="row" id="docList">
    {% for file in files %}
    <div class="col-md-4 mb-3 doc-item">
        <div class="card h-100 shadow-sm hover-shadow transition-all">
            <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-center mb-3">
                    <div class="icon-shape bg-light text-primary rounded-circle mr-3 p-3">
                        <i class="fas fa-file-alt fa-lg"></i>
                    </div>
                    <h6 class="card-title mb-0 text-truncate font-weight-bold" title="{{ file }}">
                        {{ file }}
                    </h6>
                </div>

                <div class="mt-auto">
                    <a href="{{ url_for('general.view_document', filename=file) }}"
                        class="btn btn-sm btn-outline-primary btn-block">
                        <i class="fas fa-eye"></i> Open Viewer
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
        <div class="text-muted">
            <i class="fas fa-folder-open fa-3x mb-3"></i>
            <p>No documents found. Upload one above!</p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination Controls -->
{% if total_pages > 1 %}
<nav aria-label="Document navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        <!-- Previous -->
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('general.documents', page=page-1) }}">Previous</a>
        </li>

        <!-- Page Numbers -->
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('general.documents', page=p) }}">{{ p }}</a>
        </li>
        {% endfor %}

        <!-- Next -->
        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('general.documents', page=page+1) }}">Next</a>
        </li>
    </ul>
</nav>
{% endif %}

<script>
    function filterDocs() {
        var input = document.getElementById("docSearch");
        var filter = input.value.toLowerCase();
        var nodes = document.getElementsByClassName('doc-item');

        for (i = 0; i < nodes.length; i++) {
            if (nodes[i].innerText.toLowerCase().includes(filter)) {
                nodes[i].style.display = "block";
            } else {
                nodes[i].style.display = "none";
            }
        }
    }
</script>

<style>
    .hover-shadow:hover {
        transform: translateY(-2px);
        box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .15) !important;
    }

    .transition-all {
        transition: all 0.3s ease;
    }
</style>
{% endblock %}